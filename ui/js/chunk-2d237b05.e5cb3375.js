(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d237b05"],{fbd7:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("el-card",[t("el-form",{attrs:{inline:!0}},[t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.handleEdit("")}}},[e._v("添加 ")])],1),t("el-form-item",[t("el-dropdown",{attrs:{size:"small",placement:"bottom"}},[t("el-upload",{staticClass:"uploaduser",attrs:{action:"uploaduser",accept:".xlsx, .xls","http-request":e.upLoadUser,limit:1,"show-file-list":!1}},[t("el-button",{attrs:{size:"small",icon:"el-icon-upload2",type:"primary"}},[e._v("批量添加")])],1),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",[t("el-link",{staticStyle:{"font-size":"12px"},attrs:{type:"success",href:"批量添加用户模版.xlsx"}},[t("i",{staticClass:"el-icon-download"}),e._v("下载模版 ")])],1)],1)],1)],1),t("el-form-item",{attrs:{label:"用户名或姓名或邮箱:"}},[t("el-input",{attrs:{size:"small",placeholder:"请输入内容"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchEnterFun.apply(null,arguments)}},model:{value:e.searchData,callback:function(t){e.searchData=t},expression:"searchData"}})],1),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.handleSearch()}}},[e._v("搜索 ")]),t("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:e.reset}},[e._v("重置搜索 ")])],1)],1),t("el-table",{ref:"multipleTable",attrs:{data:e.tableData,border:""}},[t("el-table-column",{attrs:{sortable:"true",prop:"id",label:"ID",width:"60"}}),t("el-table-column",{attrs:{prop:"username",label:"用户名",width:"150"}}),t("el-table-column",{attrs:{prop:"nickname",label:"姓名",width:"100"}}),t("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),t("el-table-column",{attrs:{prop:"otp_secret",label:"OTP密钥",width:"110"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.disable_otp?e._e():t("el-button",{attrs:{type:"text",icon:"el-icon-view"},on:{click:function(t){return e.getOtpImg(a.row)}}},[e._v(" "+e._s(a.row.otp_secret.substring(0,6))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"groups",label:"用户组"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.groups,(function(a){return t("el-row",{key:a},[e._v(e._s(a))])}))}}])}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"70"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.status?t("el-tag",{attrs:{type:"success"}},[e._v("可用")]):e._e(),0===a.row.status?t("el-tag",{attrs:{type:"danger"}},[e._v("停用")]):e._e(),2===a.row.status?t("el-tag",[e._v("过期")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"updated_at",label:"更新时间",formatter:e.tableDateFormat}}),t("el-table-column",{attrs:{label:"操作",width:"210"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleEdit(a.row)}}},[e._v("编辑 ")]),t("el-popconfirm",{staticClass:"m-left-10",attrs:{title:"确定要删除用户吗？"},on:{confirm:function(t){return e.handleDel(a.row)}}},[t("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v("删除 ")])],1)]}}])})],1),t("div",{staticClass:"sh-20"}),t("el-pagination",{attrs:{background:"",layout:"prev, pager, next","pager-count":11,"current-page":e.page,total:e.count},on:{"current-change":e.pageChange}})],1),t("el-dialog",{attrs:{title:"OTP密钥",visible:e.otpImgData.visible,width:"350px",center:""},on:{"update:visible":function(t){return e.$set(e.otpImgData,"visible",t)}}},[t("div",{staticStyle:{"text-align":"center"}},[e._v(e._s(e.otpImgData.username)+" : "+e._s(e.otpImgData.nickname))]),t("img",{attrs:{src:e.otpImgData.base64Img,alt:"otp-img"}})]),t("el-dialog",{attrs:{"close-on-click-modal":!1,title:"用户",visible:e.user_edit_dialog,width:"650px",center:""},on:{close:e.disVisible}},[t("el-form",{ref:"ruleForm",staticClass:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"用户ID",prop:"id"}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.id,callback:function(t){e.$set(e.ruleForm,"id",t)},expression:"ruleForm.id"}})],1),t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{attrs:{disabled:e.ruleForm.id>0},model:{value:e.ruleForm.username,callback:function(t){e.$set(e.ruleForm,"username",t)},expression:"ruleForm.username"}})],1),t("el-form-item",{attrs:{label:"姓名",prop:"nickname"}},[t("el-input",{model:{value:e.ruleForm.nickname,callback:function(t){e.$set(e.ruleForm,"nickname",t)},expression:"ruleForm.nickname"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{model:{value:e.ruleForm.email,callback:function(t){e.$set(e.ruleForm,"email",t)},expression:"ruleForm.email"}})],1),t("el-form-item",{attrs:{label:"PIN码",prop:"pin_code"}},[t("el-input",{attrs:{placeholder:"不填由系统自动生成"},model:{value:e.ruleForm.pin_code,callback:function(t){e.$set(e.ruleForm,"pin_code",t)},expression:"ruleForm.pin_code"}})],1),t("el-form-item",{attrs:{label:"过期时间",prop:"limittime"}},[t("el-date-picker",{staticStyle:{width:"130px"},attrs:{type:"date",size:"small",align:"center","picker-options":e.pickerOptions,placeholder:"选择日期"},model:{value:e.ruleForm.limittime,callback:function(t){e.$set(e.ruleForm,"limittime",t)},expression:"ruleForm.limittime"}})],1),t("el-form-item",{attrs:{label:"禁用OTP",prop:"disable_otp"}},[t("el-switch",{attrs:{"active-text":"开启OTP后，用户密码为【PIN码+OTP动态码】(中间没有+号)"},model:{value:e.ruleForm.disable_otp,callback:function(t){e.$set(e.ruleForm,"disable_otp",t)},expression:"ruleForm.disable_otp"}})],1),e.ruleForm.disable_otp?e._e():t("el-form-item",{attrs:{label:"OTP密钥",prop:"otp_secret"}},[t("el-input",{attrs:{placeholder:"不填由系统自动生成"},model:{value:e.ruleForm.otp_secret,callback:function(t){e.$set(e.ruleForm,"otp_secret",t)},expression:"ruleForm.otp_secret"}})],1),t("el-form-item",{attrs:{label:"用户组",prop:"groups"}},[t("el-checkbox-group",{model:{value:e.ruleForm.groups,callback:function(t){e.$set(e.ruleForm,"groups",t)},expression:"ruleForm.groups"}},e._l(e.grouNames,(function(e){return t("el-checkbox",{key:e,attrs:{label:e,name:e}})})),1)],1),t("el-form-item",{attrs:{label:"发送邮件",prop:"send_email"}},[t("el-switch",{model:{value:e.ruleForm.send_email,callback:function(t){e.$set(e.ruleForm,"send_email",t)},expression:"ruleForm.send_email"}})],1),t("el-form-item",{attrs:{label:"状态",prop:"status"}},[t("el-radio-group",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[t("el-radio",{attrs:{label:1,border:""}},[e._v("启用")]),t("el-radio",{attrs:{label:0,border:""}},[e._v("停用")]),t("el-radio",{attrs:{label:2,border:""}},[e._v("过期")])],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保存")]),t("el-button",{on:{click:e.disVisible}},[e._v("取消")])],1)],1)],1)],1)},l=[],s=a("bc3a"),o=a.n(s),i={name:"List",components:{},mixins:[],created(){this.$emit("update:route_path",this.$route.path),this.$emit("update:route_name",["用户信息","用户列表"])},mounted(){this.getGroups(),this.getData(1)},data(){return{page:1,grouNames:[],tableData:[],count:10,pickerOptions:{disabledDate(e){return e.getTime()<Date.now()}},searchData:"",otpImgData:{visible:!1,username:"",nickname:"",base64Img:""},ruleForm:{send_email:!0,status:1,groups:[]},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{max:50,message:"长度小于 50 个字符",trigger:"blur"}],nickname:[{required:!0,message:"请输入用户姓名",trigger:"blur"}],email:[{required:!0,message:"请输入用户邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],password:[{min:6,message:"长度大于 6 个字符",trigger:"blur"}],pin_code:[{min:6,message:"PIN码大于 6 个字符",trigger:"blur"}],date1:[{type:"date",required:!0,message:"请选择日期",trigger:"change"}],groups:[{type:"array",required:!0,message:"请至少选择一个组",trigger:"change"}],status:[{required:!0}]}}},methods:{upLoadUser(e){const t=new FormData;t.append("file",e.file),o.a.post("/user/uploaduser",t,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{0===e.data.code?(this.$message.success(e.data.data),this.getData(1)):(this.$message.error(e.data.msg),this.getData(1)),console.log(e.data)})},getOtpImg(e){this.otpImgData.visible=!0,o.a.get("/user/otp_qr",{params:{id:e.id,b64:"1"}}).then(t=>{var a=t.data;this.otpImgData.username=e.username,this.otpImgData.nickname=e.nickname,this.otpImgData.base64Img="data:image/png;base64,"+a}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})},handleDel(e){o.a.post("/user/del?id="+e.id).then(e=>{var t=e.data;0===t.code?(this.$message.success(t.msg),this.getData(1)):this.$message.error(t.msg),console.log(t)}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})},handleEdit(e){!this.$refs["ruleForm"]||this.$refs["ruleForm"].resetFields(),console.log(e),this.user_edit_dialog=!0,e&&o.a.get("/user/detail",{params:{id:e.id}}).then(e=>{var t=e.data.data;t.send_email=!1,this.ruleForm=t}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})},handleSearch(){console.log(this.searchData),this.getData(1,this.searchData)},pageChange(e){this.getData(e)},getData(e,t){this.page=e,o.a.get("/user/list",{params:{page:e,prefix:t||""}}).then(e=>{var t=e.data.data;console.log(t),this.tableData=t.datas,this.count=t.count}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})},getGroups(){o.a.get("/group/names",{}).then(e=>{var t=e.data.data;console.log(t.datas),this.grouNames=t.datas}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;o.a.post("/user/set",this.ruleForm).then(e=>{var t=e.data;0===t.code?(this.$message.success(t.msg),this.getData(1),this.user_edit_dialog=!1):this.$message.error(t.msg),console.log(t)}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})})},resetForm(e){this.$refs[e].resetFields()},searchEnterFun(e){var t=window.event?e.keyCode:e.which;13==t&&this.handleSearch()},reset(){this.searchData="",this.handleSearch()}}},n=i,u=a("2877"),m=Object(u["a"])(n,r,l,!1,null,"57419160",null);t["default"]=m.exports}}]);