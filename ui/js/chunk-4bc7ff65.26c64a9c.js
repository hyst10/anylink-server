(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4bc7ff65"],{"26ed":function(e,t,l){"use strict";l("d9a4")},"954a":function(e,t,l){"use strict";l.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("el-card",[t("el-form",{attrs:{inline:!0}},[t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.handleEdit("")}}},[e._v("添加 ")])],1)],1),t("el-table",{ref:"multipleTable",attrs:{data:e.tableData,border:""}},[t("el-table-column",{attrs:{sortable:"true",prop:"id",label:"ID",width:"60"}}),t("el-table-column",{attrs:{prop:"username",label:"用户名"}}),t("el-table-column",{attrs:{prop:"allow_lan",label:"本地网络"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-switch",{attrs:{disabled:""},model:{value:l.row.allow_lan,callback:function(t){e.$set(l.row,"allow_lan",t)},expression:"scope.row.allow_lan"}})]}}])}),t("el-table-column",{attrs:{prop:"client_dns",label:"客户端DNS",width:"160"},scopedSlots:e._u([{key:"default",fn:function(l){return e._l(l.row.client_dns,(function(l,r){return t("el-row",{key:r},[e._v(e._s(l.val))])}))}}])}),t("el-table-column",{attrs:{prop:"route_include",label:"路由包含",width:"200"},scopedSlots:e._u([{key:"default",fn:function(l){return[e._l(l.row.route_include.slice(0,e.readMinRows),(function(l,r){return t("el-row",{key:r},[e._v(e._s(l.val))])})),l.row.route_include.length>e.readMinRows?t("div",[e.readMore["ri_"+l.row.id]?t("div",e._l(l.row.route_include.slice(e.readMinRows),(function(l,r){return t("el-row",{key:r},[e._v(e._s(l.val))])})),1):e._e(),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.toggleMore("ri_"+l.row.id)}}},[e._v(e._s(e.readMore["ri_"+l.row.id]?"▲ 收起":"▼ 更多"))])],1):e._e()]}}])}),t("el-table-column",{attrs:{prop:"route_exclude",label:"路由排除",width:"200"},scopedSlots:e._u([{key:"default",fn:function(l){return[e._l(l.row.route_exclude.slice(0,e.readMinRows),(function(l,r){return t("el-row",{key:r},[e._v(e._s(l.val))])})),l.row.route_exclude.length>e.readMinRows?t("div",[e.readMore["re_"+l.row.id]?t("div",e._l(l.row.route_exclude.slice(e.readMinRows),(function(l,r){return t("el-row",{key:r},[e._v(e._s(l.val))])})),1):e._e(),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.toggleMore("re_"+l.row.id)}}},[e._v(e._s(e.readMore["re_"+l.row.id]?"▲ 收起":"▼ 更多"))])],1):e._e()]}}])}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"70"},scopedSlots:e._u([{key:"default",fn:function(l){return[1===l.row.status?t("el-tag",{attrs:{type:"success"}},[e._v("可用")]):t("el-tag",{attrs:{type:"danger"}},[e._v("停用")])]}}])}),t("el-table-column",{attrs:{prop:"updated_at",label:"更新时间",formatter:e.tableDateFormat}}),t("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleEdit(l.row)}}},[e._v("编辑 ")]),t("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确定要删除用户策略项吗？"},on:{confirm:function(t){return e.handleDel(l.row)}}},[t("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v("删除 ")])],1)]}}])})],1),t("el-pagination",{attrs:{background:"",layout:"prev, pager, next","pager-count":11,"current-page":e.page,total:e.count},on:{"current-change":e.pageChange}})],1),t("el-dialog",{attrs:{"close-on-click-modal":!1,title:"用户策略",visible:e.user_edit_dialog,width:"750px",top:"50px",center:""},on:{"update:visible":function(t){e.user_edit_dialog=t},close:e.closeDialog}},[t("el-form",{ref:"ruleForm",staticClass:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[t("el-tabs",{attrs:{"before-leave":e.beforeTabLeave},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("el-tab-pane",{attrs:{label:"通用",name:"general"}},[t("el-form-item",{attrs:{label:"ID",prop:"id"}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.id,callback:function(t){e.$set(e.ruleForm,"id",t)},expression:"ruleForm.id"}})],1),t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{attrs:{disabled:e.ruleForm.id>0},model:{value:e.ruleForm.username,callback:function(t){e.$set(e.ruleForm,"username",t)},expression:"ruleForm.username"}})],1),t("el-form-item",{attrs:{label:"本地网络",prop:"allow_lan"}},[t("el-switch",{model:{value:e.ruleForm.allow_lan,callback:function(t){e.$set(e.ruleForm,"allow_lan",t)},expression:"ruleForm.allow_lan"}})],1),t("el-form-item",{attrs:{label:"客户端DNS",prop:"client_dns"}},[t("el-row",{staticClass:"msg-info"},[t("el-col",{attrs:{span:20}},[e._v("输入IP格式如: 192.168.0.10")]),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-plus",circle:""},on:{click:function(t){return t.preventDefault(),e.addDomain(e.ruleForm.client_dns)}}})],1)],1),e._l(e.ruleForm.client_dns,(function(l,r){return t("el-row",{key:r,staticStyle:{"margin-bottom":"5px"},attrs:{gutter:10}},[t("el-col",{attrs:{span:10}},[t("el-input",{model:{value:l.val,callback:function(t){e.$set(l,"val",t)},expression:"item.val"}})],1),t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:l.note,callback:function(t){e.$set(l,"note",t)},expression:"item.note"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){return t.preventDefault(),e.removeDomain(e.ruleForm.client_dns,r)}}})],1)],1)}))],2),t("el-form-item",{attrs:{label:"状态",prop:"status"}},[t("el-radio-group",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[t("el-radio",{attrs:{label:1,border:""}},[e._v("启用")]),t("el-radio",{attrs:{label:0,border:""}},[e._v("停用")])],1)],1)],1),t("el-tab-pane",{attrs:{label:"路由设置",name:"route"}},[t("el-form-item",{attrs:{label:"包含路由",prop:"route_include"}},[t("el-row",{staticClass:"msg-info"},[t("el-col",{attrs:{span:20}},[e._v("输入CIDR格式如: 192.168.1.0/24")]),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-plus",circle:""},on:{click:function(t){return t.preventDefault(),e.addDomain(e.ruleForm.route_include)}}})],1)],1),e._l(e.ruleForm.route_include,(function(l,r){return t("el-row",{key:r,staticStyle:{"margin-bottom":"5px"},attrs:{gutter:10}},[t("el-col",{attrs:{span:10}},[t("el-input",{model:{value:l.val,callback:function(t){e.$set(l,"val",t)},expression:"item.val"}})],1),t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:l.note,callback:function(t){e.$set(l,"note",t)},expression:"item.note"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){return t.preventDefault(),e.removeDomain(e.ruleForm.route_include,r)}}})],1)],1)}))],2),t("el-form-item",{attrs:{label:"排除路由",prop:"route_exclude"}},[t("el-row",{staticClass:"msg-info"},[t("el-col",{attrs:{span:20}},[e._v("输入CIDR格式如: 192.168.2.0/24")]),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-plus",circle:""},on:{click:function(t){return t.preventDefault(),e.addDomain(e.ruleForm.route_exclude)}}})],1)],1),e._l(e.ruleForm.route_exclude,(function(l,r){return t("el-row",{key:r,staticStyle:{"margin-bottom":"5px"},attrs:{gutter:10}},[t("el-col",{attrs:{span:10}},[t("el-input",{model:{value:l.val,callback:function(t){e.$set(l,"val",t)},expression:"item.val"}})],1),t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:l.note,callback:function(t){e.$set(l,"note",t)},expression:"item.note"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){return t.preventDefault(),e.removeDomain(e.ruleForm.route_exclude,r)}}})],1)],1)}))],2)],1),t("el-tab-pane",{attrs:{label:"动态拆分隧道",name:"ds_domains"}},[t("el-form-item",{attrs:{label:"包含域名",prop:"ds_include_domains"}},[t("el-input",{attrs:{type:"textarea",rows:5},model:{value:e.ruleForm.ds_include_domains,callback:function(t){e.$set(e.ruleForm,"ds_include_domains",t)},expression:"ruleForm.ds_include_domains"}})],1),t("el-form-item",{attrs:{label:"排除域名",prop:"ds_exclude_domains"}},[t("el-input",{attrs:{type:"textarea",rows:5},model:{value:e.ruleForm.ds_exclude_domains,callback:function(t){e.$set(e.ruleForm,"ds_exclude_domains",t)},expression:"ruleForm.ds_exclude_domains"}})],1)],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保存")]),t("el-button",{on:{click:e.disVisible}},[e._v("取消")])],1)],1)],1)],1)},a=[],o=(l("14d9"),l("bc3a")),s=l.n(o),n={name:"Policy",components:{},mixins:[],created(){this.$emit("update:route_path",this.$route.path),this.$emit("update:route_name",["用户信息","用户策略"])},mounted(){this.getData(1)},data(){return{page:1,tableData:[],count:10,activeTab:"general",readMore:{},readMinRows:5,ruleForm:{bandwidth:0,status:1,allow_lan:!0,client_dns:[{val:"114.114.114.114"}],route_include:[{val:"all",note:"默认全局代理"}],route_exclude:[],re_upper_limit:0},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{max:30,message:"长度小于 30 个字符",trigger:"blur"}],bandwidth:[{required:!0,message:"请输入带宽限制",trigger:"blur"},{type:"number",message:"带宽必须为数字值"}],status:[{required:!0}]}}},methods:{handleDel(e){s.a.post("/user/policy/del?id="+e.id).then(e=>{const t=e.data;0===t.code?(this.$message.success(t.msg),this.getData(1)):this.$message.error(t.msg),console.log(t)}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})},handleEdit(e){!this.$refs["ruleForm"]||this.$refs["ruleForm"].resetFields(),console.log(e),this.activeTab="general",this.user_edit_dialog=!0,e&&s.a.get("/user/policy/detail",{params:{id:e.id}}).then(e=>{this.ruleForm=e.data.data}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})},pageChange(e){this.getData(e)},getData(e){this.page=e,s.a.get("/user/policy/list",{params:{page:e}}).then(e=>{const t=e.data.data;console.log(t),this.tableData=t.datas,this.count=t.count}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})},removeDomain(e,t){console.log(t),t>=0&&t<e.length&&e.splice(t,1)},addDomain(e){e.push({val:"",action:"allow",port:0})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;s.a.post("/user/policy/set",this.ruleForm).then(e=>{const t=e.data;0===t.code?(this.$message.success(t.msg),this.getData(1),this.user_edit_dialog=!1):this.$message.error(t.msg),console.log(t)}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})})},resetForm(e){this.$refs[e].resetFields()},toggleMore(e){this.readMore[e]?this.$set(this.readMore,e,!1):this.$set(this.readMore,e,!0)},beforeTabLeave(){var e=!0;return this.user_edit_dialog?(this.$refs["ruleForm"].validate(t=>{if(!t)return this.$message.error("错误：您有必填项没有填写。"),e=!1,!1}),e):e},closeDialog(){this.user_edit_dialog=!1,this.activeTab="general"}}},i=n,u=(l("26ed"),l("2877")),c=Object(u["a"])(i,r,a,!1,null,"eac987e0",null);t["default"]=c.exports},d9a4:function(e,t,l){}}]);