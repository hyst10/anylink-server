(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ed8a9358"],{"0576":function(e,t,l){"use strict";l.r(t);var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",[t("el-form",{attrs:{inline:!0}},[t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.handleEdit("")}}},[e._v("添加 ")])],1)],1),t("el-table",{ref:"multipleTable",attrs:{data:e.tableData,border:""}},[t("el-table-column",{attrs:{sortable:"true",prop:"id",label:"ID",width:"60"}}),t("el-table-column",{attrs:{prop:"name",label:"组名"}}),t("el-table-column",{attrs:{prop:"note",label:"备注"}}),t("el-table-column",{attrs:{prop:"allow_lan",label:"本地网络"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-switch",{attrs:{disabled:""},model:{value:l.row.allow_lan,callback:function(t){e.$set(l.row,"allow_lan",t)},expression:"scope.row.allow_lan"}})]}}])}),t("el-table-column",{attrs:{prop:"bandwidth",label:"带宽限制",width:"90"},scopedSlots:e._u([{key:"default",fn:function(l){return[l.row.bandwidth>0?t("el-row",[e._v(e._s(e.convertBandwidth(l.row.bandwidth,"BYTE","Mbps"))+" Mbps ")]):t("el-row",[e._v("不限")])]}}])}),t("el-table-column",{attrs:{prop:"client_dns",label:"客户端DNS",width:"160"},scopedSlots:e._u([{key:"default",fn:function(l){return e._l(l.row.client_dns,(function(l,a){return t("el-row",{key:a},[e._v(e._s(l.val))])}))}}])}),t("el-table-column",{attrs:{prop:"route_include",label:"路由包含",width:"180"},scopedSlots:e._u([{key:"default",fn:function(l){return[e._l(l.row.route_include.slice(0,e.readMinRows),(function(l,a){return t("el-row",{key:a},[e._v(e._s(l.val)+" ")])})),l.row.route_include.length>e.readMinRows?t("div",[e.readMore["ri_"+l.row.id]?t("div",e._l(l.row.route_include.slice(e.readMinRows),(function(l,a){return t("el-row",{key:a},[e._v(e._s(l.val)+" ")])})),1):e._e(),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.toggleMore("ri_"+l.row.id)}}},[e._v(" "+e._s(e.readMore["ri_"+l.row.id]?"▲ 收起":"▼ 更多")+" ")])],1):e._e()]}}])}),t("el-table-column",{attrs:{prop:"route_exclude",label:"路由排除",width:"180"},scopedSlots:e._u([{key:"default",fn:function(l){return[e._l(l.row.route_exclude.slice(0,e.readMinRows),(function(l,a){return t("el-row",{key:a},[e._v(e._s(l.val)+" ")])})),l.row.route_exclude.length>e.readMinRows?t("div",[e.readMore["re_"+l.row.id]?t("div",e._l(l.row.route_exclude.slice(e.readMinRows),(function(l,a){return t("el-row",{key:a},[e._v(e._s(l.val)+" ")])})),1):e._e(),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.toggleMore("re_"+l.row.id)}}},[e._v(" "+e._s(e.readMore["re_"+l.row.id]?"▲ 收起":"▼ 更多")+" ")])],1):e._e()]}}])}),t("el-table-column",{attrs:{prop:"link_acl",label:"LINK-ACL","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(l){return[e._l(l.row.link_acl.slice(0,e.readMinRows),(function(l,a){return t("el-row",{key:a},[e._v(" "+e._s(l.action)+" => "+e._s(l.val)+" : "+e._s(l.port)+" ")])})),l.row.link_acl.length>e.readMinRows?t("div",[e.readMore["la_"+l.row.id]?t("div",e._l(l.row.link_acl.slice(e.readMinRows),(function(l,a){return t("el-row",{key:a},[e._v(" "+e._s(l.action)+" => "+e._s(l.val)+" : "+e._s(l.port)+" ")])})),1):e._e(),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.toggleMore("la_"+l.row.id)}}},[e._v(" "+e._s(e.readMore["la_"+l.row.id]?"▲ 收起":"▼ 更多")+" ")])],1):e._e()]}}])}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"70"},scopedSlots:e._u([{key:"default",fn:function(l){return[1===l.row.status?t("el-tag",{attrs:{type:"success"}},[e._v("可用")]):t("el-tag",{attrs:{type:"danger"}},[e._v("停用")])]}}])}),t("el-table-column",{attrs:{prop:"updated_at",label:"更新时间",formatter:e.tableDateFormat}}),t("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleEdit(l.row)}}},[e._v("编辑 ")]),t("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确定要删除用户组吗？"},on:{confirm:function(t){return e.handleDel(l.row)}}},[t("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v("删除 ")])],1)]}}])})],1),t("div",{staticClass:"sh-20"}),t("el-pagination",{attrs:{background:"",layout:"prev, pager, next","pager-count":11,"current-page":e.page,total:e.count},on:{"current-change":e.pageChange}})],1),t("el-dialog",{attrs:{"close-on-click-modal":!1,title:"用户组",visible:e.user_edit_dialog,width:"750px",center:""},on:{"update:visible":function(t){e.user_edit_dialog=t},close:e.closeDialog}},[t("el-form",{ref:"ruleForm",staticClass:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[t("el-tabs",{attrs:{"before-leave":e.beforeTabLeave},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("el-tab-pane",{attrs:{label:"通用",name:"general"}},[t("el-form-item",{attrs:{label:"用户组ID",prop:"id"}},[t("el-input",{attrs:{disabled:""},model:{value:e.ruleForm.id,callback:function(t){e.$set(e.ruleForm,"id",t)},expression:"ruleForm.id"}})],1),t("el-form-item",{attrs:{label:"组名",prop:"name"}},[t("el-input",{attrs:{disabled:e.ruleForm.id>0},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),t("el-form-item",{attrs:{label:"备注",prop:"note"}},[t("el-input",{model:{value:e.ruleForm.note,callback:function(t){e.$set(e.ruleForm,"note",t)},expression:"ruleForm.note"}})],1),t("el-form-item",{staticStyle:{width:"260px"},attrs:{label:"带宽限制",prop:"bandwidth_format"}},[t("el-input",{attrs:{oninput:"value= value.match(/\\d+(\\.\\d{0,2})?/) ? value.match(/\\d+(\\.\\d{0,2})?/)[0] : ''"},model:{value:e.ruleForm.bandwidth_format,callback:function(t){e.$set(e.ruleForm,"bandwidth_format",t)},expression:"ruleForm.bandwidth_format"}},[t("template",{slot:"append"},[e._v("Mbps")])],2)],1),t("el-form-item",{attrs:{label:"排除本地网络",prop:"allow_lan"}},[t("el-switch",{model:{value:e.ruleForm.allow_lan,callback:function(t){e.$set(e.ruleForm,"allow_lan",t)},expression:"ruleForm.allow_lan"}}),t("div",{staticClass:"msg-info"},[e._v(" 注：本地网络 指的是： 运行 anyconnect 客户端的PC 所在的的网络，即本地路由网段。 开启后，PC本地路由网段的数据就不会走隧道链路转发数据了。 同时 anyconnect 客户端需要勾选本地网络(Allow Local Lan)的开关，功能才能生效。 ")])],1),t("el-form-item",{attrs:{label:"客户端DNS",prop:"client_dns"}},[t("el-row",{staticClass:"msg-info"},[t("el-col",{attrs:{span:20}},[e._v("输入IP格式如: 192.168.0.10")]),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-plus",circle:""},on:{click:function(t){return t.preventDefault(),e.addDomain(e.ruleForm.client_dns)}}})],1)],1),e._l(e.ruleForm.client_dns,(function(l,a){return t("el-row",{key:a,staticStyle:{"margin-bottom":"5px"},attrs:{gutter:10}},[t("el-col",{attrs:{span:10}},[t("el-input",{model:{value:l.val,callback:function(t){e.$set(l,"val",t)},expression:"item.val"}})],1),t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:l.note,callback:function(t){e.$set(l,"note",t)},expression:"item.note"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){return t.preventDefault(),e.removeDomain(e.ruleForm.client_dns,a)}}})],1)],1)}))],2),t("el-form-item",{attrs:{label:"内网域名",prop:"split_dns"}},[t("el-row",{staticClass:"msg-info"},[t("el-col",{attrs:{span:20}},[e._v("(分割DNS)一般留空。如果输入域名，只有配置的域名(包含子域名)走配置的dns")]),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-plus",circle:""},on:{click:function(t){return t.preventDefault(),e.addDomain(e.ruleForm.split_dns)}}})],1)],1),e._l(e.ruleForm.split_dns,(function(l,a){return t("el-row",{key:a,staticStyle:{"margin-bottom":"5px"},attrs:{gutter:10}},[t("el-col",{attrs:{span:10}},[t("el-input",{model:{value:l.val,callback:function(t){e.$set(l,"val",t)},expression:"item.val"}})],1),t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:l.note,callback:function(t){e.$set(l,"note",t)},expression:"item.note"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){return t.preventDefault(),e.removeDomain(e.ruleForm.split_dns,a)}}})],1)],1)}))],2),t("el-form-item",{attrs:{label:"状态",prop:"status"}},[t("el-radio-group",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[t("el-radio",{attrs:{label:1,border:""}},[e._v("启用")]),t("el-radio",{attrs:{label:0,border:""}},[e._v("停用")])],1)],1)],1),t("el-tab-pane",{attrs:{label:"认证方式",name:"authtype"}},[t("el-form-item",{attrs:{label:"认证",prop:"authtype"}},[t("el-radio-group",{on:{change:e.authTypeChange},model:{value:e.ruleForm.auth.type,callback:function(t){e.$set(e.ruleForm.auth,"type",t)},expression:"ruleForm.auth.type"}},[t("el-radio",{attrs:{label:"local",border:""}},[e._v("本地")]),t("el-radio",{attrs:{label:"radius",border:""}},[e._v("Radius")]),t("el-radio",{attrs:{label:"ldap",border:""}},[e._v("LDAP")])],1)],1),"radius"==e.ruleForm.auth.type?[t("el-form-item",{attrs:{label:"服务器地址",prop:"auth.radius.addr",rules:"radius"==this.ruleForm.auth.type?this.rules["auth.radius.addr"]:[{required:!1}]}},[t("el-input",{attrs:{placeholder:"例如 ip:1812"},model:{value:e.ruleForm.auth.radius.addr,callback:function(t){e.$set(e.ruleForm.auth.radius,"addr",t)},expression:"ruleForm.auth.radius.addr"}})],1),t("el-form-item",{attrs:{label:"密钥",prop:"auth.radius.secret",rules:"radius"==this.ruleForm.auth.type?this.rules["auth.radius.secret"]:[{required:!1}]}},[t("el-input",{attrs:{placeholder:""},model:{value:e.ruleForm.auth.radius.secret,callback:function(t){e.$set(e.ruleForm.auth.radius,"secret",t)},expression:"ruleForm.auth.radius.secret"}})],1)]:e._e(),"ldap"==e.ruleForm.auth.type?[t("el-form-item",{attrs:{label:"服务器地址",prop:"auth.ldap.addr",rules:"ldap"==this.ruleForm.auth.type?this.rules["auth.ldap.addr"]:[{required:!1}]}},[t("el-input",{attrs:{placeholder:"例如 ip:389 / 域名:389"},model:{value:e.ruleForm.auth.ldap.addr,callback:function(t){e.$set(e.ruleForm.auth.ldap,"addr",t)},expression:"ruleForm.auth.ldap.addr"}})],1),t("el-form-item",{attrs:{label:"开启TLS",prop:"auth.ldap.tls"}},[t("el-switch",{model:{value:e.ruleForm.auth.ldap.tls,callback:function(t){e.$set(e.ruleForm.auth.ldap,"tls",t)},expression:"ruleForm.auth.ldap.tls"}})],1),t("el-form-item",{attrs:{label:"管理员 DN",prop:"auth.ldap.bind_name",rules:"ldap"==this.ruleForm.auth.type?this.rules["auth.ldap.bind_name"]:[{required:!1}]}},[t("el-input",{attrs:{placeholder:"例如 CN=bindadmin,DC=abc,DC=COM"},model:{value:e.ruleForm.auth.ldap.bind_name,callback:function(t){e.$set(e.ruleForm.auth.ldap,"bind_name",t)},expression:"ruleForm.auth.ldap.bind_name"}})],1),t("el-form-item",{attrs:{label:"管理员密码",prop:"auth.ldap.bind_pwd",rules:"ldap"==this.ruleForm.auth.type?this.rules["auth.ldap.bind_pwd"]:[{required:!1}]}},[t("el-input",{attrs:{type:"password",placeholder:""},model:{value:e.ruleForm.auth.ldap.bind_pwd,callback:function(t){e.$set(e.ruleForm.auth.ldap,"bind_pwd",t)},expression:"ruleForm.auth.ldap.bind_pwd"}})],1),t("el-form-item",{attrs:{label:"Base DN",prop:"auth.ldap.base_dn",rules:"ldap"==this.ruleForm.auth.type?this.rules["auth.ldap.base_dn"]:[{required:!1}]}},[t("el-input",{attrs:{placeholder:"例如 DC=abc,DC=com"},model:{value:e.ruleForm.auth.ldap.base_dn,callback:function(t){e.$set(e.ruleForm.auth.ldap,"base_dn",t)},expression:"ruleForm.auth.ldap.base_dn"}})],1),t("el-form-item",{attrs:{label:"用户对象类",prop:"auth.ldap.object_class",rules:"ldap"==this.ruleForm.auth.type?this.rules["auth.ldap.object_class"]:[{required:!1}]}},[t("el-input",{attrs:{placeholder:"例如 person / user / posixAccount"},model:{value:e.ruleForm.auth.ldap.object_class,callback:function(t){e.$set(e.ruleForm.auth.ldap,"object_class",t)},expression:"ruleForm.auth.ldap.object_class"}})],1),t("el-form-item",{attrs:{label:"用户唯一ID",prop:"auth.ldap.search_attr",rules:"ldap"==this.ruleForm.auth.type?this.rules["auth.ldap.search_attr"]:[{required:!1}]}},[t("el-input",{attrs:{placeholder:"例如 sAMAccountName / uid / cn"},model:{value:e.ruleForm.auth.ldap.search_attr,callback:function(t){e.$set(e.ruleForm.auth.ldap,"search_attr",t)},expression:"ruleForm.auth.ldap.search_attr"}})],1),t("el-form-item",{attrs:{label:"受限用户组",prop:"auth.ldap.member_of"}},[t("el-input",{attrs:{placeholder:"选填, 只允许指定组登入, 例如 CN=HomeWork,DC=abc,DC=com"},model:{value:e.ruleForm.auth.ldap.member_of,callback:function(t){e.$set(e.ruleForm.auth.ldap,"member_of",t)},expression:"ruleForm.auth.ldap.member_of"}})],1)]:e._e()],2),t("el-tab-pane",{attrs:{label:"路由设置",name:"route"}},[t("el-form-item",{attrs:{label:"包含路由",prop:"route_include"}},[t("el-row",{staticClass:"msg-info"},[t("el-col",{attrs:{span:18}},[e._v("输入CIDR格式如: 192.168.1.0/24")]),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-plus",circle:""},on:{click:function(t){return t.preventDefault(),e.addDomain(e.ruleForm.route_include)}}})],1),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{size:"mini",type:"info",icon:"el-icon-edit",circle:""},on:{click:function(t){return t.preventDefault(),e.openIpListDialog("route_include")}}})],1)],1),"route"==e.activeTab?t("templete",e._l(e.ruleForm.route_include,(function(l,a){return t("el-row",{key:a,staticStyle:{"margin-bottom":"5px"},attrs:{gutter:10}},[t("el-col",{attrs:{span:10}},[t("el-input",{model:{value:l.val,callback:function(t){e.$set(l,"val",t)},expression:"item.val"}})],1),t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:l.note,callback:function(t){e.$set(l,"note",t)},expression:"item.note"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){return t.preventDefault(),e.removeDomain(e.ruleForm.route_include,a)}}})],1)],1)})),1):e._e()],1),t("el-form-item",{attrs:{label:"排除路由",prop:"route_exclude"}},[t("el-row",{staticClass:"msg-info"},[t("el-col",{attrs:{span:18}},[e._v("输入CIDR格式如: 192.168.2.0/24")]),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-plus",circle:""},on:{click:function(t){return t.preventDefault(),e.addDomain(e.ruleForm.route_exclude)}}})],1),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{size:"mini",type:"info",icon:"el-icon-edit",circle:""},on:{click:function(t){return t.preventDefault(),e.openIpListDialog("route_exclude")}}})],1)],1),"route"==e.activeTab?t("templete",e._l(e.ruleForm.route_exclude,(function(l,a){return t("el-row",{key:a,staticStyle:{"margin-bottom":"5px"},attrs:{gutter:10}},[t("el-col",{attrs:{span:10}},[t("el-input",{model:{value:l.val,callback:function(t){e.$set(l,"val",t)},expression:"item.val"}})],1),t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:l.note,callback:function(t){e.$set(l,"note",t)},expression:"item.note"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){return t.preventDefault(),e.removeDomain(e.ruleForm.route_exclude,a)}}})],1)],1)})),1):e._e()],1)],1),t("el-tab-pane",{attrs:{label:"权限控制",name:"link_acl"}},[t("el-form-item",{attrs:{label:"权限控制",prop:"link_acl"}},[t("el-row",{staticClass:"msg-info"},[t("el-col",{attrs:{span:22}},[e._v("输入CIDR格式如: 192.168.3.0/24 端口0表示所有端口,多个端口用','号分隔,连续端口:1234-5678 ")]),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-plus",circle:""},on:{click:function(t){return t.preventDefault(),e.addDomain(e.ruleForm.link_acl)}}})],1)],1),e._l(e.ruleForm.link_acl,(function(l,a){return t("el-row",{key:a,staticStyle:{"margin-bottom":"5px"},attrs:{gutter:1}},[t("el-col",{attrs:{span:10}},[t("el-input",{attrs:{placeholder:"请输入CIDR地址"},model:{value:l.val,callback:function(t){e.$set(l,"val",t)},expression:"item.val"}},[t("el-select",{attrs:{slot:"prepend"},slot:"prepend",model:{value:l.action,callback:function(t){e.$set(l,"action",t)},expression:"item.action"}},[t("el-option",{attrs:{label:"允许",value:"allow"}}),t("el-option",{attrs:{label:"禁止",value:"deny"}})],1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{placeholder:"多端口,号分隔"},model:{value:l.port,callback:function(t){e.$set(l,"port",t)},expression:"item.port"}})],1),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:l.note,callback:function(t){e.$set(l,"note",t)},expression:"item.note"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){return t.preventDefault(),e.removeDomain(e.ruleForm.link_acl,a)}}})],1)],1)}))],2)],1),t("el-tab-pane",{attrs:{label:"域名拆分隧道",name:"ds_domains"}},[t("el-form-item",{attrs:{label:"包含域名",prop:"ds_include_domains"}},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"输入域名用,号分隔，默认匹配所有子域名, 如baidu.com,163.com"},model:{value:e.ruleForm.ds_include_domains,callback:function(t){e.$set(e.ruleForm,"ds_include_domains",t)},expression:"ruleForm.ds_include_domains"}})],1),t("el-form-item",{attrs:{label:"排除域名",prop:"ds_exclude_domains"}},[t("el-input",{attrs:{type:"textarea",rows:5,placeholder:"输入域名用,号分隔，默认匹配所有子域名, 如baidu.com,163.com"},model:{value:e.ruleForm.ds_exclude_domains,callback:function(t){e.$set(e.ruleForm,"ds_exclude_domains",t)},expression:"ruleForm.ds_exclude_domains"}}),t("div",{staticClass:"msg-info"},[e._v("注：域名拆分隧道，仅支持AnyConnect的windows和MacOS桌面客户端，不支持移动端.")])],1)],1),t("el-form-item",["authtype"==e.activeTab&&"local"!=e.ruleForm.auth.type?t("templete",[t("el-button",{staticStyle:{"margin-right":"10px"},on:{click:function(t){return e.openAuthLoginDialog()}}},[e._v("测试登录")])],1):e._e(),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保存")]),t("el-button",{on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1)],1),t("el-dialog",{attrs:{"close-on-click-modal":!1,title:"测试用户登录",visible:e.authLoginDialog,width:"600px","custom-class":"valgin-dialog",center:""},on:{"update:visible":function(t){e.authLoginDialog=t}}},[t("el-form",{ref:"authLoginForm",attrs:{model:e.authLoginForm,rules:e.authLoginRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"账号",prop:"name"}},[t("el-input",{ref:"authLoginFormName",nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.testAuthLogin.apply(null,arguments)}},model:{value:e.authLoginForm.name,callback:function(t){e.$set(e.authLoginForm,"name",t)},expression:"authLoginForm.name"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"pwd"}},[t("el-input",{attrs:{type:"password"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.testAuthLogin.apply(null,arguments)}},model:{value:e.authLoginForm.pwd,callback:function(t){e.$set(e.authLoginForm,"pwd",t)},expression:"authLoginForm.pwd"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.authLoginLoading},on:{click:function(t){return e.testAuthLogin()}}},[e._v("登录")]),t("el-button",{on:{click:function(t){e.authLoginDialog=!1}}},[e._v("取 消")])],1)],1)],1),t("el-dialog",{attrs:{"close-on-click-modal":!1,title:"编辑模式",visible:e.ipListDialog,width:"650px","custom-class":"valgin-dialog",center:""},on:{"update:visible":function(t){e.ipListDialog=t}}},[t("el-form",{ref:"ipEditForm",attrs:{"label-width":"80px"}},[t("el-form-item",{attrs:{label:"路由表",prop:"ip_list"}},[t("el-input",{attrs:{type:"textarea",rows:10,placeholder:"每行一条路由，例：192.168.1.0/24,备注 或 192.168.1.0/24"},model:{value:e.ipEditForm.ip_list,callback:function(t){e.$set(e.ipEditForm,"ip_list",t)},expression:"ipEditForm.ip_list"}}),t("div",{staticClass:"msg-info"},[e._v("当前共 "+e._s(""===e.ipEditForm.ip_list.trim()?0:e.ipEditForm.ip_list.trim().split("\n").length)+" 条（注：AnyConnect客户端最多支持"+e._s(this.maxRouteRows)+"条路由） ")])],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.ipEditLoading},on:{click:function(t){return e.ipEdit()}}},[e._v("更新")]),t("el-button",{on:{click:function(t){e.ipListDialog=!1}}},[e._v("取 消")])],1)],1)],1)],1)},r=[],o=(l("14d9"),l("bc3a")),i=l.n(o),s={name:"List",components:{},mixins:[],created(){this.$emit("update:route_path",this.$route.path),this.$emit("update:route_name",["用户组信息","用户组列表"])},mounted(){this.getData(1),this.setAuthData()},data(){return{page:1,tableData:[],count:10,activeTab:"general",readMore:{},readMinRows:5,maxRouteRows:2500,defAuth:{type:"local",radius:{addr:"",secret:""},ldap:{addr:"",tls:!1,base_dn:"",object_class:"person",search_attr:"sAMAccountName",member_of:"",bind_name:"",bind_pwd:""}},ruleForm:{bandwidth:0,bandwidth_format:"0",status:1,allow_lan:!0,client_dns:[{val:"114.114.114.114",note:"默认dns"}],split_dns:[],route_include:[{val:"all",note:"默认全局代理"}],route_exclude:[],link_acl:[],auth:{}},authLoginDialog:!1,ipListDialog:!1,authLoginLoading:!1,authLoginForm:{name:"",pwd:""},ipEditForm:{ip_list:"",type:""},ipEditLoading:!1,authLoginRules:{name:[{required:!0,message:"请输入账号",trigger:"blur"}],pwd:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"长度至少 6 个字符",trigger:"blur"}]},rules:{name:[{required:!0,message:"请输入组名",trigger:"blur"},{max:30,message:"长度小于 30 个字符",trigger:"blur"}],bandwidth_format:[{required:!0,message:"请输入带宽限制",trigger:"blur"},{type:"string",message:"带宽限制必须为数字值"}],status:[{required:!0}],"auth.radius.addr":[{required:!0,message:"请输入Radius服务器",trigger:"blur"}],"auth.radius.secret":[{required:!0,message:"请输入Radius密钥",trigger:"blur"}],"auth.ldap.addr":[{required:!0,message:"请输入服务器地址(含端口)",trigger:"blur"}],"auth.ldap.bind_name":[{required:!0,message:"请输入管理员 DN",trigger:"blur"}],"auth.ldap.bind_pwd":[{required:!0,message:"请输入管理员密码",trigger:"blur"}],"auth.ldap.base_dn":[{required:!0,message:"请输入Base DN值",trigger:"blur"}],"auth.ldap.object_class":[{required:!0,message:"请输入用户对象类",trigger:"blur"}],"auth.ldap.search_attr":[{required:!0,message:"请输入用户唯一ID",trigger:"blur"}]}}},methods:{setAuthData(e){e?("ldap"!=e.auth.type||e.auth.ldap.object_class||(e.auth.ldap.object_class=this.defAuth.ldap.object_class),this.ruleForm.auth=Object.assign(JSON.parse(JSON.stringify(this.defAuth)),e.auth)):this.ruleForm.auth=JSON.parse(JSON.stringify(this.defAuth))},handleDel(e){i.a.post("/group/del?id="+e.id).then(e=>{const t=e.data;0===t.code?(this.$message.success(t.msg),this.getData(1)):this.$message.error(t.msg),console.log(t)}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})},handleEdit(e){!this.$refs["ruleForm"]||this.$refs["ruleForm"].resetFields(),console.log(e),this.user_edit_dialog=!0,e?i.a.get("/group/detail",{params:{id:e.id}}).then(e=>{e.data.data.bandwidth_format=this.convertBandwidth(e.data.data.bandwidth,"BYTE","Mbps").toString(),this.ruleForm=e.data.data,this.setAuthData(e.data.data)}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)}):this.setAuthData(e)},pageChange(e){this.getData(e)},getData(e){this.page=e,i.a.get("/group/list",{params:{page:e}}).then(e=>{const t=e.data.data;console.log(t),this.tableData=t.datas,this.count=t.count}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})},removeDomain(e,t){console.log(t),t>=0&&t<e.length&&e.splice(t,1)},addDomain(e){console.log("arr",e),e.push({val:"",action:"allow",port:"0",note:""})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;this.ruleForm.bandwidth=this.convertBandwidth(this.ruleForm.bandwidth_format,"Mbps","BYTE"),i.a.post("/group/set",this.ruleForm).then(e=>{const t=e.data;0===t.code?(this.$message.success(t.msg),this.getData(1),this.user_edit_dialog=!1):this.$message.error(t.msg),console.log(t)}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e)})})},testAuthLogin(){this.$refs["authLoginForm"].validate(e=>{if(!e)return console.log("error submit!!"),!1;this.authLoginLoading=!0,i.a.post("/group/auth_login",{name:this.authLoginForm.name,pwd:this.authLoginForm.pwd,auth:this.ruleForm.auth}).then(e=>{const t=e.data;0===t.code?this.$message.success("登录成功"):this.$message.error(t.msg),this.authLoginLoading=!1,console.log(t)}).catch(e=>{this.$message.error("哦，请求出错"),console.log(e),this.authLoginLoading=!1})})},openAuthLoginDialog(){this.$refs["ruleForm"].validate(e=>{if(!e)return console.log("error submit!!"),!1;this.authLoginDialog=!0,this.$nextTick(()=>{this.$refs["authLoginFormName"].focus()})})},openIpListDialog(e){this.ipListDialog=!0,this.ipEditForm.type=e,this.ipEditForm.ip_list=this.ruleForm[e].map(e=>e.val+(e.note?","+e.note:"")).join("\n")},ipEdit(){this.ipEditLoading=!0;let e=[];""!==this.ipEditForm.ip_list.trim()&&(e=this.ipEditForm.ip_list.trim().split("\n"));let t=[];for(let l=0;l<e.length;l++){let a=e[l];if(""===a.trim())continue;let r=a.split(",");r.length>2&&(r[1]=r.slice(1).join(","));let o=r[1]?r[1]:"";const i=()=>{t.push({val:r[0],note:o})};if("route_include"==this.ipEditForm.type&&"all"==r[0]){i();continue}let s=this.isValidCIDR(r[0]);if(!s.valid)return this.$message.error("错误：CIDR格式错误，建议 "+r[0]+" 改为 "+s.suggestion),void(this.ipEditLoading=!1);i()}this.ruleForm[this.ipEditForm.type]=t,this.ipEditLoading=!1,this.ipListDialog=!1},isValidCIDR(e){const t=/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)\/([12]?\d|3[0-2])$/;if(!t.test(e))return{valid:!1,suggestion:null};const[l,a]=e.split("/"),r=parseInt(a),o=l.split(".").map(e=>parseInt(e)),i=o.map(e=>e.toString(2).padStart(8,"0")).join("");for(let s=r;s<32;s++)if("1"===i[s]){const e=i.substring(0,r).padEnd(32,"0"),t=[];for(let a=0;a<4;a++){const l=e.substring(8*a,8*(a+1));t.push(parseInt(l,2))}const l=t.join(".");return{valid:!1,suggestion:`${l}/${a}`}}return{valid:!0,suggestion:null}},resetForm(e){this.$refs[e].resetFields()},toggleMore(e){this.readMore[e]?this.$set(this.readMore,e,!1):this.$set(this.readMore,e,!0)},authTypeChange(){this.$refs["ruleForm"].clearValidate()},beforeTabLeave(){var e=!0;return this.user_edit_dialog?(this.$refs["ruleForm"].validate(t=>{if(!t)return this.$message.error("错误：您有必填项没有填写。"),e=!1,!1}),e):e},closeDialog(){this.user_edit_dialog=!1,this.activeTab="general"},convertBandwidth(e,t,l){const a={bps:1,Kbps:1e3,Mbps:1e6,Gbps:1e9,BYTE:8},r=e*a[t]/a[l],o=r.toFixed(2);return parseFloat(o)}}},n=s,u=(l("e860"),l("2877")),c=Object(u["a"])(n,a,r,!1,null,"39758bc7",null);t["default"]=c.exports},e860:function(e,t,l){"use strict";l("f34c")},f34c:function(e,t,l){}}]);